var shopify=function(e){this.website=e?e:"";this.results=[]};shopify.prototype.ajax=function(e,t,n,r,i){var s=this.website+e.trim();var r=r&&!isNaN(r)?r:86400;var o="shopifyAPI-"+encodeURIComponent(s);if(localStorage&&localStorage[o]){var u=JSON.parse(localStorage[o]);if(u.url==s&&Math.round((new Date).getTime()/1e3)-u.lastUpdate<r&&u.data.length>0){this.results=new shopifyResults(u.data);if(t)t(this.results);return}}var a=s.match(/\&|\?callback\=\?/)?"jsonp":"xml";if(s.slice(-2)=="js"&&a=="xml"){a="json"}var f="http://jadedpixel.com/-/spec/shopify";if(!n){var n=[]}$.ajax({dataType:a,url:s,success:function(e,r,l){var c=[];if(a=="json"){if(n.length>0){var h={};for(var p in e){if(jQuery.inArray(p,n)>=0){h[p]=e[p]}}c.push(h)}else{c.push(e)}}else{if(a==="jsonp"){var e=decodeURIComponent(e.data)}try{$(e).find("entry").each(function(e){var t={};t.title=$(this).find("> title").text();t.id=$(this).find("> id").text();t.published=$(this).find("> published").text();t.updated=$(this).find("> updated").text();if(n.length==0||jQuery.inArray("summary",n)>=0){t.summary=$(this).find("summary").text().trim()}var r=this.getElementsByTagNameNS(f,"*");for(var e in r){switch(r[e].nodeName){case"s:tag":case"s:type":case"s:vendor":if(r[e].firstChild.nodeValue&&(n.length==0||jQuery.inArray(r[e].nodeName,n)>=0)){var i=r[e].tagName.match(/^s\:([\w]+)$/);if(r[e].nodeName=="s:vendor"){t[i[1]]=r[e].firstChild.nodeValue}else{if(!t[i[1]]){t[i[1]]=new Array}t[i[1]].push(r[e].firstChild.nodeValue)}}break;case"s:variant":if(n.length==0||jQuery.inArray("s:variant",n)>=0){var s={};if(!t["variant"]){t["variant"]=new Array}for(var o=1;o<11;o+=2){s[r[e].childNodes[o].nodeName]=$(r[e].childNodes[o]).text()}t["variant"].push(s)}break}}c.push(t)})}catch(d){console.log("Error : "+d);if(u.url==s&&u.data.length>0){this.results=new shopifyResults(u.data);if(t)t(this.results)}else if(i&&i!=""){i(jqXHR,r,errorThrown)}return}}this.results=c;if(localStorage&&this.results.length>0){if(!localStorage[o]){localStorage[o]=""}var c={url:s,lastUpdate:Math.round((new Date).getTime()/1e3),data:this.results};localStorage[o]=JSON.stringify(c)}var v=new shopifyResults(this.results);if(t)t(v)},error:function(e,n,r){console.log("There was an error with the Shopify AJAX call");if(u.url==s&&u.data.length>0){this.results=new shopifyResults(u.data);if(t)t(this.results);return}else if(i&&i!=""){i(e,n,r)}return}})};var shopifyResults=function(e){this.results=e};shopifyResults.prototype.get=function(e){var t=[];for(var n in this.results){if(this.results.hasOwnProperty(n)&&!isNaN(n)){t.push(this.results[n][e])}}return t};shopifyResults.prototype.sortBy=function(e,t){var n=this.results.slice(0);if(t){}else{if(e=="id"){var r=[];e="stripped_id";for(var i in n){var s=n[i].id.match(/\/(\d+)/);if(s[1]){n[i][e]=parseInt(s[1])}}}n.sort(function(t,n){if(t[e]<n[e])return-1;if(t[e]>n[e])return 1;return 0})}return new shopifyResults(n)};shopifyResults.prototype.query=function(e,t){var n=e.match(/^([\w\:]+)\s?(\!?\=|\!?contains)\s?(?:\'|\")([\w\s\:]+)(?:\'|\")/);var t=!t?"":t;if(n.length===4){var r=[];var i=t.indexOf("i")!=-1?false:true;if(!i){n[3]=n[3].toLowerCase()}for(var s=0;s<this.results.length;s++){var o=this.results[s][n[1]];if(!i){var o=o.toLowerCase()}if(n[2]=="="&&o===n[3]||n[2]=="!="&&o!==n[3]||n[2]=="contains"&&o.indexOf(n[3])!=-1||n[2]=="!contains"&&o.indexOf(n[3])==-1){r.push(this.results[s])}}}return new shopifyResults(r)}